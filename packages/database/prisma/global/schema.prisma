generator client {
  provider = "prisma-client-js"
  output   = "../../src/generated/global-client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum TenantStatus {
  QUEUED
  PROVISIONING
  ACTIVE
  SUSPENDED
  FAILED
}

enum GlobalUserRole {
  GLOBAL_ADMIN
}

model Tenant {
  id          String       @id @default(uuid())
  name        String
  slug        String       @unique
  status      TenantStatus @default(QUEUED)
  databaseUrl String?

  subscriptions Subscription[]
  features      TenantFeature[]
  billingRecords BillingRecord[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("tenants")
}

model GlobalUser {
  id       String         @id @default(uuid())
  email    String         @unique
  password String
  name     String
  role     GlobalUserRole @default(GLOBAL_ADMIN)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("global_users")
}

model Plan {
  id          String @id @default(uuid())
  name        String @unique
  price       Decimal @db.Decimal(10, 2)
  maxProducts Int
  maxUsers    Int

  subscriptions Subscription[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("plans")
}

model Subscription {
  id           String  @id @default(uuid())
  tenantId     String
  tenant       Tenant  @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  planId       String
  plan         Plan    @relation(fields: [planId], references: [id])
  rentalFee    Decimal @default(0) @db.Decimal(10, 2)
  billingCycle String  @default("MONTHLY")
  status       String  @default("ACTIVE")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("subscriptions")
}

model Feature {
  id          String @id @default(uuid())
  name        String @unique
  description String?

  tenantFeatures TenantFeature[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("features")
}

model TenantFeature {
  id        String  @id @default(uuid())
  tenantId  String
  tenant    Tenant  @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  featureId String
  feature   Feature @relation(fields: [featureId], references: [id], onDelete: Cascade)
  enabled   Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([tenantId, featureId])
  @@map("tenant_features")
}

model BillingRecord {
  id       String @id @default(uuid())
  tenantId String
  tenant   Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  amount   Decimal @db.Decimal(12, 2)
  type     String
  status   String @default("PENDING")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("billing_records")
}

model AuditLog {
  id       String @id @default(uuid())
  userId   String
  action   String
  resource String
  details  String?

  createdAt DateTime @default(now())

  @@map("audit_logs")
}
